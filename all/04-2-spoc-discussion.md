#lec9: 虚存置换算法spoc练习

## 视频相关思考题

### 9.1 页面置换算法的概念

1. 设计置换算法时需要考虑哪些影响因素？如何评判的好坏？
	+ 设计置换算法时需要考虑的因素有可行性与实现的复杂度、对之后调用情况的预计因素，过去页面的调用情况等。
	+ 通过一段序列的缺页次数来评判置换算法的好坏。

2. 全局和局部置换算法的不同？
	+ 全局置换算法是对物理内存中的所有页面进行统一的调度，替换的页面可能是其他进程的页面。
	+ 局部置换算法是对一个进程内页面进行调度，替换的页面是同一个进程的其他页面。

### 9.2 最优算法、先进先出算法和最近最久未使用算法

1. 最优算法、先进先出算法和LRU算法的思路？
	+ 最优算法：假设我们可以提前知道未来所有页面的调用情况，在出现缺页异常之后，对所有物理内存中的页面按照之后第一次访问的位置进行从大到小的排序，替换最晚出现调用的页面。
	+ 先进先出算法：记录物理内存中每一个页面装载进入内存的顺序，在出现缺页异常之后，将最早装载进入内存的页面替换。
	+ LRU算法：根据过去的页面调用时间，按照从小到大的顺序排序，将最早调用的页面替换出去。

### 9.3 时钟置换算法和最不常用算法

1. 时钟置换算法的思路？
	+ 将所有页面构造出一个环形链表，每次访问一个页面时都修改该页面的访问位为1.
	+ 出现缺页异常之后，从链表指针起始位置一次扫描链表中所有的页面，若访问位为0，则替换该页面，若访问位为1，则将其修改为0，同时指针向后移动一位。

2. 改进的时钟置换算法与时钟置换算法有什么不同？
	+ 为了减少页面修改导致的写入内存的消耗，改进的时钟算法考虑了修改位的信息。
	+ 所有页面依然构成一个环形链表，每次访问一个页面没有修改时只是修改其访问位为1，如为写操作修改了页面内容，则修改位也设置为1。
	+ 在出现缺页异常之后，将00页面置换出去，对于01的页面，将其变为00，即通过某种方法将修改内容写入外存，指针移动；对于10的情况，变为00，指针移动；对于11的情况，变为01，指针移动。

3. LFU算法的思路？
	+ 维护一个记录每个页面访问次数的栈。
	+ 出现缺页异常后将最少访问次数的页面替换。


### 9.4 Belady现象和局部置换算法比较

1. 什么是Belady现象？如何判断一种置换算法是否存在Belady现象？
	+ Belady现象是指物理页面数量增加后，程序出现的缺页次数反而增加的现象。
	+ 如果能够举出一个出现Belady现象的例子，则证明一种置换算法存在belady现象。
	+ 一般来说如果能够增明在每次出现缺页异常时，增加页面前的物理内存中的页面集合是增加页面后的物理内存中的页面集合的子集。

2. 请证明LRU算法不存在Belady现象。
	+ 我们假设物理内存增加前页面数量为n，增加后页面数量为m，m > n.
    + LRU算法中我们构造一个访问时间从近到远的栈，栈顶为最近访问的页面，则在每次访问时，都会将这次访问的页面移动到栈顶，所以任何时刻，物理内存增加后的栈的前n项与物理内存增加前栈内内容完全相同。
    + 所以在每次访问异常出现时，物理内存增加后的页面集合包含物理内存增加前的页面集合。不会发生Belady现象。

### 9.5 工作集置换算法

1. CPU利用率与并发进程数的关系是什么？
	+ CPU利用率在并发进程数少的情况下利用率随着并发进程数的增加而增加，在增长到一定程度之后，由于并发进程数导致的缺页率的增加会使CPU利用率下降。

2. 什么是工作集？
   + 进程当前使用的逻辑页面的集合。

3. 什么是常驻集？
   + 当前时刻进程实际驻留内存的页面的集合。

4. 工作集算法的思路？
   + 思路是把不在工作集中的页面置换出去，随着工作集的移动，分配给进程的物理页面数发生动态的变化。

### 9.6 缺页率置换算法

1. 缺页率算法的思路？
   + 依据缺页之间的间隔来调整将哪些页面放置到内存中去。当两次缺页的时间间隔大于一个特定值，则将不在两次缺页之间的页面置换出内存；若两次缺页的时间间隔小于特定的值，则缺失的页加入到内存中，增加常驻集的大小。

### 9.7 抖动和负载控制

1. 什么是虚拟内存管理的抖动现象？
	+ 进程的物理页面数太少，不能包含工作集所以造成大量缺页，需要进行页面的频繁置换，导致程序的运行速度变慢。

2. 操作系统负载控制的最佳状态是什么状态？
	+ CPU利用率达到最高。

3. 局部置换算法（如FIFO, LRU等）是否能作为全局置换算法来使用？为什么？
	+ 可以，可以把所有程序想像成一个大程序的不同部分，可以把他们使用的所有页面通过局部置算法来进行缺页的处理，但可能导致进程切换时出现大量的缺页异常。

----

## 扩展思考题

1.  改进时钟置换算法的极端情况: 如果所有的页面都被修改过了，这时需要分配新的页面时，算法的performance会如何？能否改进在保证正确的前提下提高缺页中断的处理时间？

2.  如何设计改进时钟算法的写回策略?

3. （spoc）根据你的`学号 mod 4`的结果值，确定选择四种页面置换算法（0：LRU置换算法，1:改进的clock 页置换算法，2：工作集页置换算法，3：缺页率置换算法）中的一种来设计一个应用程序（可基于python, ruby, C, C++，LISP等）模拟实现，并给出测试用例和测试结果。请参考如python代码或独自实现。
 - [页置换算法实现的参考实例](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab3/page-replacement-policy.py)     

4. 请判断OPT、LRU、FIFO、Clock和LFU等各页面置换算法是否存在Belady现象？如果存在，给出实例；如果不存在，给出证明。

5. 了解LIRS页置换算法的设计思路，尝试用高级语言实现其基本思路。此算法是江松博士（导师：张晓东博士）设计完成的，非常不错！
	- 参考信息：
 	- [LIRS conf paper](http://www.ece.eng.wayne.edu/~sjiang/pubs/papers/jiang02_LIRS.pdf)
	 - [LIRS journal paper](http://www.ece.eng.wayne.edu/~sjiang/pubs/papers/jiang05_LIRS.pdf)
	 - [LIRS-replacement ppt1](http://dragonstar.ict.ac.cn/course_09/XD_Zhang/(6)-LIRS-replacement.pdf)
	 - [LIRS-replacement ppt2](http://www.ece.eng.wayne.edu/~sjiang/Projects/LIRS/sig02.ppt)
